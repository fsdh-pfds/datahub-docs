# Entity Framework (EF) Migrations Overview

Migrations in Entity Framework (EF) Core allow developers to manage database schema changes over time. As the application evolves, its data model changes. Migrations track these changes through code files, enabling a database schema to be incrementally updated to match the data model.

## Introduction

Entity Framework Core (EF Core) is a lightweight, extensible, and open-source Object-Relational Mapping (ORM) framework for .NET. It simplifies the task of manipulating and querying databases using .NET objects. It provides a database-agnostic approach to writing data access code and supports multiple database providers, such as SQL Server and SQLite.

In the world of databases, migrations are a way of handling changes in the database schema. This is necessary because changes in your codebase can affect the structure of your database, such as adding a new field to a class. Migrations help us manage these changes, enabling us to version control our database schema and propagate changes across different environments smoothly. For more detailed insights on migrations, you may refer to [Microsoft's official documentation](https://docs.microsoft.com/en-us/ef/core/managing-schemas/migrations/).

## Key Concepts

- **Migration Files**: EF Core generates C# files for each migration, containing the necessary commands to update the database schema. These files can be edited if needed.
- **DbContext**: The central class in EF Core that coordinates EF functionality for a given data model. Migrations use the `DbContext` to determine the changes needed in the database.
- **Database Providers**: EF Core supports multiple database systems (e.g., SQL Server, SQLite, PostgreSQL). Migrations are specific to the database provider used by the application.
- **Applying Migrations**: Migrations can be applied programmatically or via the EF Core command-line tools. This process updates the database schema to match the current model.
- **Rolling Back Migrations**: EF Core allows rolling back to previous migrations, enabling developers to revert the database schema to an earlier state.
- **Idempotency**: The migration scripts generated by EF Core are idempotent, meaning they can be run multiple times without causing errors or unintended changes.

## Our Implementation

Context is implemented in `DataHubDBContext`

In each of these specialized DbContexts, we have overridden the `OnConfiguring` method to add provider-specific configurations. This is where we define the specific database provider we want to use. Notably, we have employed conditional compilation symbols denoted by `#if MIGRATION`. This ensures that the specific provider's configuration is only included in the build when we define `MIGRATION` as the build configuration. 

## DHMigrations.ps1
This PowerShell script was introduced to simplify the process outlined in the next section. Once the script runs successfully nothing else is required.

### Open a terminal in the DataHub.Core project

```sh
cd domain\DataHub.Core
```

### Remove Migration

```sh
.\DHMigrations.ps1 -Action RemoveMigration
```

### Add Migration

```sh
.\DHMigrations.ps1 -Action AddMigration -MigrationName <MigrationName>
```
